<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Connection Test</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #0a0a0f;
            color: white;
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
        }

        .status {
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            border: 2px solid #333;
        }

        .success {
            border-color: #10B981;
            background: rgba(16, 185, 129, 0.1);
        }

        .error {
            border-color: #EF4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .info {
            border-color: #3B82F6;
            background: rgba(59, 130, 246, 0.1);
        }

        button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            margin: 10px 10px 10px 0;
        }

        button:hover {
            transform: translateY(-2px);
        }

        pre {
            background: #1a1a24;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
        }
    </style>
</head>

<body>
    <h1>ðŸ”¥ Firebase Connection Test</h1>
    <p>This page will test your Firebase configuration and database connection.</p>

    <div id="status"></div>

    <button onclick="testConnection()">Test Firebase Connection</button>
    <button onclick="testCreateOrder()">Test Create Order</button>
    <button onclick="testReadOrders()">Test Read Orders</button>

    <div id="results"></div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCJc3ZLiR9BSB01hOaSRHO3lSmLf0le8zw",
            authDomain: "instagrow-x.firebaseapp.com",
            projectId: "instagrow-x",
            storageBucket: "instagrow-x.firebasestorage.app",
            messagingSenderId: "320041630068",
            appId: "1:320041630068:web:01cde8140ceb3750ee9421",
            measurementId: "G-WMVHQCMEZS"
        };

        let app, db;
        const statusDiv = document.getElementById('status');
        const resultsDiv = document.getElementById('results');

        function showStatus(message, type = 'info') {
            statusDiv.innerHTML += `<div class="status ${type}">${message}</div>`;
        }

        function showResults(data) {
            resultsDiv.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }

        // Initialize Firebase
        try {
            app = firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            showStatus('âœ… Firebase initialized successfully!', 'success');
            showStatus(`ðŸ“¦ Project ID: ${firebaseConfig.projectId}`, 'info');
        } catch (error) {
            showStatus(`âŒ Firebase initialization failed: ${error.message}`, 'error');
        }

        async function testConnection() {
            showStatus('ðŸ”„ Testing Firestore connection...', 'info');
            try {
                const testRef = db.collection('_test').doc('connection');
                await testRef.set({
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    test: true
                });
                showStatus('âœ… Successfully connected to Firestore!', 'success');
                showStatus('âœ… Write permission verified', 'success');

                // Clean up
                await testRef.delete();
            } catch (error) {
                showStatus(`âŒ Connection failed: ${error.message}`, 'error');
                if (error.code === 'permission-denied') {
                    showStatus('âš ï¸ Permission Denied! You need to set up Firestore security rules.', 'error');
                    showStatus('ðŸ“– See FIRESTORE_RULES.md for instructions', 'info');
                }
            }
        }

        async function testCreateOrder() {
            showStatus('ðŸ”„ Testing order creation...', 'info');
            try {
                const testOrder = {
                    orderId: 'TEST' + Date.now(),
                    username: 'testuser',
                    email: 'test@example.com',
                    package: 'starter',
                    packageName: 'Starter',
                    followers: 100,
                    amount: 349,
                    status: 'pending',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                const docRef = await db.collection('orders').add(testOrder);
                showStatus(`âœ… Test order created successfully! ID: ${docRef.id}`, 'success');
                showResults({ success: true, orderId: docRef.id, data: testOrder });
            } catch (error) {
                showStatus(`âŒ Order creation failed: ${error.message}`, 'error');
                showResults({ error: error.message, code: error.code });
            }
        }

        async function testReadOrders() {
            showStatus('ðŸ”„ Reading orders from database...', 'info');
            try {
                const snapshot = await db.collection('orders').limit(5).get();
                const orders = [];
                snapshot.forEach(doc => {
                    orders.push({ id: doc.id, ...doc.data() });
                });

                showStatus(`âœ… Successfully read ${orders.length} order(s)`, 'success');
                showResults(orders);
            } catch (error) {
                showStatus(`âŒ Read failed: ${error.message}`, 'error');
                showResults({ error: error.message, code: error.code });
            }
        }

        // Auto-test on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                showStatus('ðŸš€ Running automatic connection test...', 'info');
                testConnection();
            }, 1000);
        });
    </script>
</body>

</html>